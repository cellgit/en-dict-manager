# 词汇管理后台 PRD

## 1. 产品概述
- **产品名称**：词汇管理后台（Dict Admin）
- **产品定位**：支持教辅词汇资产的一站式管理平台，覆盖词条清洗、导入、维护与质检。
- **目标用户**：教资内容团队、教研编辑、数据运营人员、技术支持工程师。

## 2. 背景与动机
- 教辅团队每日更新大量单词释义、例句与近义词，需要统一的后台以避免 Excel 导入分散、字段缺失等质量问题。
- 现有流程缺乏验证机制，重复劳动和导入失败率高，且难以追踪问题单词。
- 项目希望通过标准化的词条结构、可视化 CRUD 操作和批量导入能力，提升词汇资产管理效率 ≥ 40%。

## 3. 目标与成功指标
| 目标 | 指标 | 衡量方式 |
| ---- | ---- | -------- |
| 提升词条维护效率 | 单词的创建/更新时长 ≤ 2 分钟 | 任务测时与用户调查 |
| 降低批量导入失败率 | 首次导入成功率 ≥ 90%，失败条目可追溯 | 导入日志审计 |
| 强化数据一致性 | 关键字段（释义、例句）缺失率 ≤ 5% | Prisma 数据库巡检 |
| 支撑质量追踪 | 导入批次与日志完整记录覆盖率 100% | 审计报表 |

## 4. 用户画像与场景
- **教研编辑（核心用户）**：维护日常词条，频繁使用搜索、详情查看和单词创建功能。
- **内容运营**：批量导入新教材词汇，关注导入总结、错误反馈和回溯。
- **技术支持**：排查导入失败原因，需快速定位日志并复现。
- **产品/质量团队**：关注整体数据健康度、指标准确性。

## 5. 用户旅程
1. 登录后台首页，浏览最新数据概览（后续阶段）。
2. 在词条列表中通过关键字或音标搜索目标单词。
3. 打开详情侧栏查看释义、例句、短语、近义词、相关词。
4. 若需要新增词条，打开创建表单，填写完整结构并提交。
5. 如需批量更新，进入导入模块，上传规范化 JSON，执行 Dry Run 校验，确认无误后正式导入。
6. 导入结束后，查看成功/失败统计，并可下载或查看逐条日志。

## 6. 功能范围与需求明细

### 6.1 词条管理（核心）
| 功能 | 描述 | 交互/验收标准 |
| ---- | ---- | -------------- |
| 列表展示 | 展示词条基础信息：单词、音标、词频、教材、更新时间 | 默认按更新时间倒序；支持分页（后端默认限制）；美英音标显示在主行内 |
| 搜索与筛选 | 支持按词头精确/模糊搜索，后端按 headword 索引 | 输入词头后触发查询；无结果展示空态文案 |
| 详情侧栏 | 选中词条后展示释义、例句、短语、近义词分组、相关词 | 结构清晰，字段缺失时显示“暂无数据”；支持关闭侧栏 |
| 创建单词 | 提供完整表单，涵盖词头、音标、释义、例句、近义词组、短语、相关词 | 必填项校验（词头、释义、例句等）；提交成功后刷新列表并提示 |
| 删除单词 | 提供带确认开关的删除功能 | 开关默认关闭，开启后才显示删除按钮；删除成功后刷新列表 |

### 6.2 批量导入
| 功能 | 描述 | 交互/验收标准 |
| ---- | ---- | -------------- |
| JSON 导入表单 | 用户粘贴或上传经过清洗的 JSON 数组 | 提供示例提示；支持 Dry Run |
| Dry Run 校验 | 在正式导入前执行模拟，返回预计写入数量、被跳过原因 | 校验不写库，展示结构化总结 |
| 正式导入 | Dry Run 通过后执行写库，生成 ImportBatch + ImportLog | 完成后提示成功条数、失败条数，提供错误详情 |

### 6.3 系统审计与反馈
| 功能 | 描述 | 交互/验收标准 |
| ---- | ---- | -------------- |
| 导入日志 | 保存每个词条在导入时的状态，支持按批次关联 | 在技术文档中说明查询方式；后续可在 UI 暴露 |
| 错误提示 | 表单与导入失败信息以结构化、可读形式展示 | 与后端 Zod 校验保持一致，避免模糊报错 |

### 6.4 非功能性需求
- **性能**：列表与搜索需在 500ms 内返回（10k 级词库）；导入批处理分批提交事务，避免锁表。
- **可靠性**：所有批量导入操作需使用事务与日志保障可回滚；失败时返回明确错误信息。
- **可扩展性**：数据结构允许新增音频、图片等附加信息；代码分层便于未来接入多语言版本。
- **安全性**：仅内部可访问（依赖外部 SSO/Basic Auth，当前阶段假定已通过部署策略限制）。

### 6.5 发音资源策略
- 单词读音统一使用有道 DictVoice 接口生成，地址格式为 `https://dict.youdao.com/dictvoice?audio={word}&type={variant}`。
- `type=1` 代表美式读音，`type=2` 代表英式读音；`word` 参数使用词头原文并经过 URL 编码。
- 服务层在保存/读取词条时自动填充该链接，前端表单仅展示只读字段，避免手工维护音频 URL。
- 若词头为空或包含非法字符，接口会生成空值；需提醒录入人员确保词头准确。

## 7. 交付范围与里程碑
| 里程碑 | 内容 | 预计时间 |
| ------ | ---- | -------- |
| M1 | 完成 Prisma 数据模型与服务层 CRUD | 第 1 周 |
| M2 | 完成词条管理 UI（搜索、详情、创建、删除） | 第 2 周 |
| M3 | 完成批量导入流程（Dry Run + 实际导入 + 日志） | 第 3 周 |
| M4 | 内部上手测试与文档完善 | 第 4 周 |

## 8. 依赖与风险
- **依赖**：PostgreSQL 数据库、Prisma Client、Next.js 部署环境；需要内容团队提供清洗过的数据格式模板。
- **数据库托管**：默认连接阿里云 PostgreSQL（`pgm-uf60twss3ymh9bv4qo.pg.rds.aliyuncs.com:5432/bear_dict`，`Bear_translate`）。本地开发可改写 `DATABASE_URL` 使用 Docker。
- **Schema 同步**：远程数据库首次部署需执行 `FORCE_REMOTE_DB_SYNC=1 npm run db:sync`（可选 `DB_SYNC_MODE=push`、`RUN_DB_SEED=1`）。
- **风险**：
  - 原始数据格式不一致导致导入失败率升高；需借助 `dict-cleaner` 预处理。
  - 导入规模大时的性能瓶颈；应通过批次与事务封装控制。
  - 权限控制尚未实现，需要部署时通过网段/身份验证限制访问。

## 9. 附录
- 数据模型主键约束（表名统一使用 `dict_` 前缀且字段为蛇形命名）：

| 表名 | 主键字段 | 类型 | 默认值 |
| ---- | -------- | ---- | ------ |
| `dict_word` | `id` | UUID | `@id @default(uuid())` |
| `dict_definition` | `id` | UUID | `@id @default(uuid())` |
| `dict_example_sentence` | `id` | UUID | `@id @default(uuid())` |
| `dict_synonym_group` | `id` | UUID | `@id @default(uuid())` |
| `dict_synonym` | `id` | UUID | `@id @default(uuid())` |
| `dict_phrase` | `id` | UUID | `@id @default(uuid())` |
| `dict_related_word` | `id` | UUID | `@id @default(uuid())` |
| `dict_import_batch` | `id` | UUID | `@id @default(uuid())` |
| `dict_import_log` | `id` | UUID | `@id @default(uuid())` |

- 数据示例、字段说明、Dry Run 输出示例详见技术实现文档。
